var JSKOMMENT={},JSKOMMENT_CONFIG=window.JSKOMMENT_CONFIG||{};JSKOMMENT.url=JSKOMMENT_CONFIG.url||"http://jskomment.appspot.com",JSKOMMENT.CSS=JSKOMMENT_CONFIG.CSS||"./client/jskomment.css",JSKOMMENT.waitImg=JSKOMMENT_CONFIG.waitImg||"./client/modal-ajax-wait.gif",JSKOMMENT.captcha_message=JSKOMMENT_CONFIG.captcha_message||"Captcha (submit to reload a new one): ",JSKOMMENT.protocol=JSKOMMENT_CONFIG.protocol||"GUESS",JSKOMMENT.maxComments=JSKOMMENT_CONFIG.maxComments||10,JSKOMMENT.supportedProtocols={},JSKOMMENT.format_function=JSKOMMENT_CONFIG.format_function||function(a){try{return _spoonware.npe(a,"str").replace(/\n/g,"<br/>")}catch(b){return _spoonware.handleCatched("exception",b)}},JSKOMMENT.get_comment_key_function=JSKOMMENT_CONFIG.get_comment_key_function||function(){try{return _spoonware.npe(document.location.href,"document.location.href").split("#")[0]}catch(a){return _spoonware.handleCatched("exception",a)}},window.console&&(_spoonware.npe(window.console,"window.console").log("using server (JSKOMMENT.url):"+JSKOMMENT.url),_spoonware.npe(window.console,"window.console").log("using protocol (JSKOMMENT.protocol):"+JSKOMMENT.protocol)),JSKOMMENT.ajax=function(a,b,c){try{var d=c||JSKOMMENT.protocol;if("PROBE"==d&&(d=_spoonware.npe(JSKOMMENT,"JSKOMMENT").preferredProtocol()),"ALL_GET"==d)a.type="get",a.contentType="application/x-www-form-urlencoded",a.accepts={json:"application/json"},a.dataType="json",a.data={data:_spoonware.npe(JSON,"JSON").stringify(a.data)};else if("JSONP"==d)a.contentType="application/jsonp",a.accepts={jsonp:"application/javascript"},a.dataType="jsonp",a.data={data:_spoonware.npe(JSON,"JSON").stringify(a.data),contentType:"application/jsonp"};else if("FLASH"==d)a.type=b,a.contentType="application/x-www-form-urlencoded",a.accepts={json:"application/json"},a.dataType="json",a.data={data:_spoonware.npe(JSON,"JSON").stringify(a.data)},a.xhr=JSKOMMENT.xhr;else{if("REST"!=d)throw"oops no protocol "+d;a.type=b,a.dataType="json",a.contentType="application/json",a.accepts={json:"application/json"},a.data=_spoonware.npe(JSON,"JSON").stringify(a.data)}_spoonware.npe($,"$").ajax(a)}catch(e){return _spoonware.handleCatched("exception",e)}},JSKOMMENT.send=function(a,b){try{if(!_spoonware.npe($(a),"$(elem)").hasClass("jskomment")){var c="error in API usage";throw _spoonware.npe(window.console,"window.console").log(c),c}var d={};_spoonware.npe($(_spoonware.npe(_spoonware.npe($(a),"$(elem)").find(".jskomment_form"),"_spoonware.npe($(elem),'$(elem)').find('.jskomment_form')").serializeArray()),"$(_spoonware.npe(_spoonware.npe($(elem),'$(elem)').find('.jskomment_form'),'_spoonware.npe($(elem),'$(elem)').find('.jskomment_form')').serializeArray())").each(function(a,b){try{d[b.name]=b.value}catch(c){return _spoonware.handleCatched("exception",c)}});try{localStorage&&_spoonware.npe(localStorage,"localStorage").setItem("jskomment_username",_spoonware.npe(_spoonware.npe($(a),"$(elem)").find('input[name="name"]'),"_spoonware.npe($(elem),'$(elem)').find('input[name='name']')").val())}catch(e){_spoonware.report("handled",e)}try{localStorage&&_spoonware.npe(localStorage,"localStorage").setItem("jskomment_email",_spoonware.npe(_spoonware.npe($(a),"$(elem)").find('input[name="email"]'),"_spoonware.npe($(elem),'$(elem)').find('input[name='email']')").val())}catch(e){_spoonware.report("handled",e)}var f={url:JSKOMMENT.url+"/p",dataType:"json",data:d,success:function(c){try{_spoonware.npe(JSKOMMENT,"JSKOMMENT").load(a),b&&b()}catch(d){return _spoonware.handleCatched("exception",d)}},error:function(b,c){try{if(403==b.status)try{_spoonware.npe(JSKOMMENT_CONFIG,"JSKOMMENT_CONFIG").authenticate(a)}catch(d){_spoonware.report("handled",d),_spoonware.npe($(".jskomment"),"$('.jskomment')").text("[jskomment] error no function authenticate while server sends 403 unauthorized"+d)}503==b.status&&alert(b.responseText)}catch(e){return _spoonware.handleCatched("exception",e)}}};try{_spoonware.npe(JSKOMMENT,"JSKOMMENT").ajax(f,"POST")}catch(e){_spoonware.report("handled",e),_spoonware.npe(window.console,"window.console").log(e)}return!1}catch(g){return _spoonware.handleCatched("exception",g)}},JSKOMMENT.display=function(a){try{var b=a.length;if(0==b)return;var c=a[0].title,d=$('[_title="'+c+'"]');_spoonware.npe(_spoonware.npe(d,"elem").find(".jskomment_header"),"_spoonware.npe(elem,'elem').find('.jskomment_header')").html($('<a href="javascript:void(0)">Discussion ('+b+")</a>")),b>JSKOMMENT.maxComments&&!_spoonware.npe(_spoonware.npe(d,"elem").find(".jskomment_previous"),"_spoonware.npe(elem,'elem').find('.jskomment_previous')").attr("add_comment")&&_spoonware.npe(_spoonware.npe(d,"elem").find(".jskomment_previous, .jskomment_add_comment"),"_spoonware.npe(elem,'elem').find('.jskomment_previous, .jskomment_add_comment')").hide(),_spoonware.npe(_spoonware.npe(d,"elem").find(".jskomment_previous"),"_spoonware.npe(elem,'elem').find('.jskomment_previous')").empty(),_spoonware.npe(_spoonware.npe(d,"elem").find(".jskomment_form"),"_spoonware.npe(elem,'elem').find('.jskomment_form')").replaceWith(_spoonware.npe(JSKOMMENT,"JSKOMMENT").createAddCommentElement()),_spoonware.npe($(a),"$(array)").each(function(a,b){try{if(!b||b.title!=c)return;var e=_spoonware.npe($('<span class="jskomment_user"/>'),"$('<span class='jskomment_user'/>')").text(b.name+": "),f=_spoonware.npe($('<span class="jskomment_commentval"/>'),"$('<span class='jskomment_commentval'/>')").html(_spoonware.npe(JSKOMMENT,"JSKOMMENT").format_function(b.comment)),g="";b.date&&(g=_spoonware.npe($('<span class="jskomment_date"/>'),"$('<span class='jskomment_date'/>')").text("("+b.date+")"));var h=_spoonware.npe(_spoonware.npe(_spoonware.npe($('<div class="jskomment_comment"/>'),"$('<div class='jskomment_comment'/>')").append(e),"_spoonware.npe($('<div class='jskomment_comment'/>'),'$('<div class='jskomment_comment'/>')').append(ePoster)").append(f),"_spoonware.npe(_spoonware.npe($('<div class='jskomment_comment'/>'),'$('<div class='jskomment_comment'/>')').append(ePoster),'_spoonware.npe($('<div class='jskomment_comment'/>'),'$('<div class='jskomment_comment'/>')').append(ePoster)').append(eContent)").append(g);_spoonware.npe(_spoonware.npe(d,"elem").find(".jskomment_previous"),"_spoonware.npe(elem,'elem').find('.jskomment_previous')").append(h)}catch(i){return _spoonware.handleCatched("exception",i)}}),_spoonware.npe(JSKOMMENT,"JSKOMMENT").enableForms()}catch(e){return _spoonware.handleCatched("exception",e)}},JSKOMMENT.multiload=function(a){try{var b={url:JSKOMMENT.url+"/sx",data:a,success:function(a){try{_spoonware.npe($(a),"$(val)").each(function(a,b){try{_spoonware.npe(JSKOMMENT,"JSKOMMENT").display(b)}catch(c){return _spoonware.handleCatched("exception",c)}})}catch(b){return _spoonware.handleCatched("exception",b)}},error:function(a){try{_spoonware.npe($(".jskomment"),"$('.jskomment')").text("[jskomment] AJAX error, server message: "+_spoonware.npe(a,"e").error().responseText),_spoonware.npe(window.console,"window.console").error("JSKOMMENT.multiload:"+_spoonware.npe(a,"e").error().responseText)}catch(b){return _spoonware.handleCatched("exception",b)}}};_spoonware.npe(JSKOMMENT,"JSKOMMENT").ajax(b,"POST")}catch(c){return _spoonware.handleCatched("exception",c)}},JSKOMMENT.load=function(a){try{if(!_spoonware.npe($(a),"$(elem)").hasClass("jskomment")){var b="error in API usage";throw _spoonware.npe(window.console,"window.console").log(b),b}_spoonware.npe(JSKOMMENT,"JSKOMMENT").ajax({url:JSKOMMENT.url+"/s",data:{title:_spoonware.npe($(a),"$(elem)").attr("_title")},success:JSKOMMENT.display},"GET")}catch(c){return _spoonware.handleCatched("exception",c)}},JSKOMMENT.createAddCommentElement=function(){try{var a=$(_spoonware.npe(document,"document").createElement("a"));return _spoonware.npe(a,"addCommentLink").attr("href","javascript:void(0)"),_spoonware.npe(a,"addCommentLink").attr("class","jskomment_add_comment"),_spoonware.npe(a,"addCommentLink").text("Click to leave a comment"),_spoonware.npe(a,"addCommentLink").click(function(){try{var a=this;_spoonware.npe($(a),"$(clicked)").hide();var b=_spoonware.npe($(a),"$(clicked)").parents(".jskomment");_spoonware.npe(_spoonware.npe(b,"elem").find(".jskomment_previous"),"_spoonware.npe(elem,'elem').find('.jskomment_previous')").show(),_spoonware.npe(_spoonware.npe(b,"elem").find(".jskomment_previous"),"_spoonware.npe(elem,'elem').find('.jskomment_previous')").attr("add_comment",!0);var c=_spoonware.npe(b,"elem").attr("_title"),d="your name";try{d=_spoonware.npe(localStorage,"localStorage").getItem("jskomment_username")||d}catch(e){_spoonware.report("handled",e)}var f="";try{f=_spoonware.npe(localStorage,"localStorage").getItem("jskomment_email")||f}catch(e){_spoonware.report("handled",e)}var g=$('<form class="jskomment_form jskomment_add_comment"><input id="title" type="hidden" name="title" value="'+c+'"/><div class="jskomment_input1">New comment from <input type="text" name="name" size="15"  value="'+d+'"/>: </div><div class="jskomment_input1">Email (optional, for pingback): <input type="text" name="email" size="15"  value="'+f+'"/>: </div><div class="jskomment_commentval"><textarea class="jskomment_input2" rows="6" cols="32" name="comment" value="your comment"/></div></form>');_spoonware.npe(g,"form").submit(function(a){try{return _spoonware.npe(JSKOMMENT,"JSKOMMENT").disableForms(),_spoonware.npe(JSKOMMENT,"JSKOMMENT").send(_spoonware.npe($(a.target),"$(ev.target)").parents(".jskomment")),!1}catch(b){return _spoonware.handleCatched("exception",b)}}),_spoonware.npe(_spoonware.npe($(a),"$(clicked)").parents(".jskomment"),"_spoonware.npe($(clicked),'$(clicked)').parents('.jskomment')").append(g),_spoonware.npe($(a),"$(clicked)").remove(),_spoonware.npe($('<div class="jskomment_captcha"></div>'),"$('<div class='jskomment_captcha'></div>')").appendTo(g),_spoonware.npe($('<div class="jskomment_submit"><input class="jskomment_button" name="submit" type="submit" value="submit"/></div>'),"$('<div class='jskomment_submit'><input class='jskomment_button' name='submit' type='submit' value='submit'/></div>')").appendTo(g)}catch(h){return _spoonware.handleCatched("exception",h)}}),a}catch(b){return _spoonware.handleCatched("exception",b)}},JSKOMMENT.init=function(a){try{if(!_spoonware.npe($(a),"$(elem)").hasClass("jskomment")){var b="error in API usage";throw _spoonware.npe(window.console,"window.console").log(b),b}var c=_spoonware.npe($(a),"$(elem)").attr("title");(void 0===c||""===c)&&(c=_spoonware.npe(JSKOMMENT,"JSKOMMENT").get_comment_key_function(a)),_spoonware.npe($(a),"$(elem)").attr("_title",c),_spoonware.npe($(a),"$(elem)").attr("title","Commenting area powered by jskomment");var d=$('<div class="jskomment_header"></div>');_spoonware.npe(d,"jskomment_header").click(function(){try{_spoonware.npe(_spoonware.npe($(a),"$(elem)").find(".jskomment_previous, .jskomment_add_comment"),"_spoonware.npe($(elem),'$(elem)').find('.jskomment_previous, .jskomment_add_comment')").toggle()}catch(b){return _spoonware.handleCatched("exception",b)}}),_spoonware.npe(d,"jskomment_header").appendTo(a);var e=$('<div class="jskomment_previous"></div>');_spoonware.npe(e,"jskomment_previous").appendTo(a);var f=_spoonware.npe(JSKOMMENT,"JSKOMMENT").createAddCommentElement();_spoonware.npe(f,"addCommentLink").appendTo($(a))}catch(g){return _spoonware.handleCatched("exception",g)}},JSKOMMENT.testConnection=function(a){try{_spoonware.npe(JSKOMMENT,"JSKOMMENT").ajax({url:JSKOMMENT.url+"/t",data:"REST",success:function(a){try{"REST"===a&&(JSKOMMENT.supportedProtocols.REST="ok")}catch(b){return _spoonware.handleCatched("exception",b)}}},"POST","REST"),JSKOMMENT.usingFlash&&_spoonware.npe(JSKOMMENT,"JSKOMMENT").ajax({url:JSKOMMENT.url+"/t",data:"FLASH",success:function(a){try{"FLASH"===a&&(JSKOMMENT.supportedProtocols.FLASH="ok")}catch(b){return _spoonware.handleCatched("exception",b)}}},"POST","FLASH"),_spoonware.npe(JSKOMMENT,"JSKOMMENT").ajax({url:JSKOMMENT.url+"/t",data:"JSONP",success:function(a){try{"JSONP"===a&&(JSKOMMENT.supportedProtocols.JSONP="ok")}catch(b){return _spoonware.handleCatched("exception",b)}}},"POST","JSONP"),_spoonware.npe(JSKOMMENT,"JSKOMMENT").ajax({url:JSKOMMENT.url+"/t",data:"ALL_GET",success:function(a){try{"ALL_GET"===a&&(JSKOMMENT.supportedProtocols.ALL_GET="ok")}catch(b){return _spoonware.handleCatched("exception",b)}}},"POST","ALL_GET")}catch(b){return _spoonware.handleCatched("exception",b)}},JSKOMMENT.guessProtocol=function(){try{void 0!==(new XMLHttpRequest).withCredentials?JSKOMMENT.protocol="REST":JSKOMMENT.usingFlash?JSKOMMENT.protocol="FLASH":JSKOMMENT.protocol="JSONP"}catch(a){return _spoonware.handleCatched("exception",a)}},JSKOMMENT.preferredProtocol=function(){try{return"REST"in JSKOMMENT.supportedProtocols?"REST":"FLASH"in JSKOMMENT.supportedProtocols?"FLASH":"JSONP"in JSKOMMENT.supportedProtocols?"JSONP":"ALL_GET"in JSKOMMENT.supportedProtocols?"ALL_GET":"JSONP"}catch(a){return _spoonware.handleCatched("exception",a)}},JSKOMMENT.loadSWF=function(a){try{if(window.swfobject){var b=$(_spoonware.npe(document,"document").createElement("div"));_spoonware.npe(b,"flash").attr({id:"jskomment_flash"}),_spoonware.npe(b,"flash").appendTo($("body")),_spoonware.npe(swfobject,"swfobject").embedSWF(JSKOMMENT.url+"/swfhttprequest.swf","jskomment_flash","0","0","9.0.0",!1,!1,{allowscriptaccess:"always"},{allowscriptaccess:"always"},function(b){try{b.success?(window.console&&_spoonware.npe(window.console,"window.console").log("flash enabled"),JSKOMMENT.usingFlash=!0,JSKOMMENT.xhr=function(){try{return new(_spoonware.npe(window,"window").SWFHttpRequest)}catch(a){return _spoonware.handleCatched("exception",a)}},setTimeout(function(){try{a(!0)}catch(b){return _spoonware.handleCatched("exception",b)}},500)):a(!1)}catch(c){return _spoonware.handleCatched("exception",c)}})}}catch(c){return _spoonware.handleCatched("exception",c)}},JSKOMMENT.main=function(){try{_spoonware.npe($(document),"$(document)").ready(function(){try{_spoonware.npe(JSKOMMENT,"JSKOMMENT").mainContinue();var a=$(_spoonware.npe(document,"document").createElement("link"));_spoonware.npe(a,"css").attr({rel:"stylesheet",type:"text/css",href:JSKOMMENT.CSS}),_spoonware.npe(a,"css").appendTo($("head"))}catch(b){return _spoonware.handleCatched("exception",b)}})}catch(a){return _spoonware.handleCatched("exception",a)}},JSKOMMENT.mainContinue=function(){try{"FLASH"===JSKOMMENT.protocol&&_spoonware.npe(JSKOMMENT,"JSKOMMENT").loadSWF(function(a){try{}catch(b){return _spoonware.handleCatched("exception",b)}}),"PROBE"===JSKOMMENT.protocol&&_spoonware.npe(JSKOMMENT,"JSKOMMENT").testConnection(),"GUESS"===JSKOMMENT.protocol&&_spoonware.npe(JSKOMMENT,"JSKOMMENT").guessProtocol(),setTimeout(function(){try{_spoonware.npe($(".jskomment"),"$('.jskomment')").each(function(a,b){try{_spoonware.npe(JSKOMMENT,"JSKOMMENT").init(b)}catch(c){return _spoonware.handleCatched("exception",c)}});var a=[];_spoonware.npe($(".jskomment"),"$('.jskomment')").each(function(b,c){try{_spoonware.npe(a,"request").push({title:_spoonware.npe($(c),"$(elem)").attr("_title")})}catch(d){return _spoonware.handleCatched("exception",d)}}),_spoonware.npe(JSKOMMENT,"JSKOMMENT").multiload(a)}catch(b){return _spoonware.handleCatched("exception",b)}},500)}catch(a){return _spoonware.handleCatched("exception",a)}},JSKOMMENT.uniqid=function(a,b){try{"undefined"==typeof a&&(a="");var c,d=function(a,b){try{return a=_spoonware.npe(parseInt(a,10),"parseInt(seed,10)").toString(16),b<a.length?_spoonware.npe(a,"seed").slice(a.length-b):b>a.length?_spoonware.npe(Array(1+(b-a.length)),"Array(1+(reqWidth-seed.length))").join("0")+a:a}catch(c){return _spoonware.handleCatched("exception",c)}};return this.php_js||(this.php_js={}),this.php_js.uniqidSeed||(this.php_js.uniqidSeed=_spoonware.npe(Math,"Math").floor(123456789*_spoonware.npe(Math,"Math").random())),this.php_js.uniqidSeed++,c=a,c+=d(parseInt(_spoonware.npe(new Date,"new Date").getTime()/1e3,10),8),c+=d(this.php_js.uniqidSeed,5),b&&(c+=_spoonware.npe(_spoonware.npe(10*_spoonware.npe(Math,"Math").random(),"_spoonware.npe(Math,'Math').random()*10").toFixed(8),"_spoonware.npe(_spoonware.npe(Math,'Math').random()*10,'_spoonware.npe(Math,'Math').random()*10').toFixed(8)").toString()),c}catch(e){return _spoonware.handleCatched("exception",e)}},JSKOMMENT.disableForms=function(){try{var a=$('.jskomment input[type="submit"]');_spoonware.npe(a,"submit").attr("disabled",!0),_spoonware.npe(a,"submit").after($('<img class="modal-ajax-wait" src="'+JSKOMMENT.waitImg+'"/>'))}catch(b){return _spoonware.handleCatched("exception",b)}},JSKOMMENT.enableForms=function(){try{var a=$('.jskomment input[type="submit"]');_spoonware.npe(a,"submit").attr("disabled",!1),_spoonware.npe(_spoonware.npe(_spoonware.npe(a,"submit").parent(),"_spoonware.npe(submit,'submit').parent()").find(".modal-ajax-wait"),"_spoonware.npe(_spoonware.npe(submit,'submit').parent(),'_spoonware.npe(submit,'submit').parent()').find('.modal-ajax-wait')").remove()}catch(b){return _spoonware.handleCatched("exception",b)}},JSKOMMENT.authenticate_with_captcha_default=function(a){try{_spoonware.npe($,"$").ajax({url:JSKOMMENT_CONFIG.captcha_url,success:function(a){try{_spoonware.npe($(".jskomment_captcha"),"$('.jskomment_captcha')").html($("<div>"+JSKOMMENT.captcha_message+'<img src="data:image/jpeg;base64,'+a.challenge_data+'"/></div>')),_spoonware.npe($('<input type="hidden" name="captcha_challenge_field" value="'+a.challenge_id+'"/>'),"$('<input type='hidden' name='captcha_challenge_field' value=''+response.challenge_id+''/>')").appendTo($(".jskomment_captcha")),_spoonware.npe($('<input type="text" name="captcha_response_field"/>'),"$('<input type='text' name='captcha_response_field'/>')").appendTo($(".jskomment_captcha")),_spoonware.npe(JSKOMMENT,"JSKOMMENT").enableForms()}catch(b){return _spoonware.handleCatched("exception",b)}}})}catch(b){return _spoonware.handleCatched("exception",b)}};